const ULID_CHARS="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ULID_TIMESTAMP_LENGTH=10,UUID_TIMESTAMP_LENGTH=12,TIMESTAMP_MIN=0,TIMESTAMP_MAX=0xffffffffffff,FACTORY_DATA_MIN=BigInt("302240678275694148452352"),FACTORY_DATA_MAX=BigInt("377789318629571617095679"),regexULID=/^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$/i,regexUUID=/^\{?[0-9A-F]{8}-?[0-9A-F]{4}-?[0-9A-F]{4}-?[0-9A-F]{4}-?[0-9A-F]{12}\}?$/i,ERROR_INVALID="Invalid format",ERROR_TIMESTAMP=`Timestamp (##VALUE##) must be between ${TIMESTAMP_MIN} and `+TIMESTAMP_MAX,ERROR_DATA=`Data value (##VALUE##) must be between ${FACTORY_DATA_MIN} and `+FACTORY_DATA_MAX;function isULID(t){return"string"==typeof t&&regexULID.test(t)}function isUUID(t){return"string"==typeof t&&regexUUID.test(t)}function getIdFormat(t){t=isULID(t)?"ulid":isUUID(t)?"uuid":null;if(null===t)throw new Error(ERROR_INVALID);return t}function parseBigInt(t,e){var r="-"===t.charAt(0),t=t.slice(r?1:0).split("").reduce((t,r)=>t*BigInt(e)+BigInt(parseInt(r,e)),BigInt(0));return r?-t:t}function base32ToCrockford(t){return t.toUpperCase().split("").map(t=>{var r=t.charCodeAt(0);let e=0;return 73<=r?(e++,75<=r&&e++,77<=r&&e++,82<=r&&e++,String.fromCharCode(r+e)):t}).join("")}function crockfordToBase32(t){return t.toUpperCase().split("").map(t=>{var r=t.charCodeAt(0);let e=0;return 74<=r?(e++,77<=r&&e++,80<=r&&e++,86<=r&&e++,String.fromCharCode(r-e)):t}).join("").toLowerCase()}function cleanUUID(t){return t.replace(/[-\{\}]/g,"")}function randomData(t){var r=[...crypto.getRandomValues(new Uint16Array(5))].map((t,r)=>{switch(r){case 0:return Math.floor(t/65535*4096)+16384;case 1:return Math.floor(t/65535*32767)+32768;default:return t}}).map(t=>t.toString(16).padStart(4,"0")).join("");return"uuid"===t?r:convertData(r,"uuid","ulid")}function convertData(t,r,e){return"uuid"===r?(t=(t=cleanUUID(t)).substring(t.length-20).toLowerCase(),"uuid"===e?t:base32ToCrockford(parseBigInt(t,16).toString(32))):(t=t.substring(t.length-16).toUpperCase(),"ulid"===e?t:parseBigInt(crockfordToBase32(t),32).toString(16))}function encodeTimestamp(t,r="ulid"){return"uuid"===r?t.toString(16).toUpperCase():base32ToCrockford(t.toString(32))}function decodeTimestamp(t,r="ulid"){return"uuid"===r?parseInt(cleanUUID(t).substring(0,UUID_TIMESTAMP_LENGTH).toLowerCase(),16):parseInt(crockfordToBase32(t.substring(0,ULID_TIMESTAMP_LENGTH).toUpperCase()),32)}function convertID(t,r){if("string"!=typeof t||"string"!=typeof r)throw new Error(ERROR_INVALID);var e=getIdFormat(t);return e===r?t:("uuid"===r?formatUUID:formatULID)(encodeTimestamp(decodeTimestamp(t,e),r),convertData(t,e,r))}function validateTimestamp(t){if(t<TIMESTAMP_MIN||t>TIMESTAMP_MAX)throw new Error(ERROR_TIMESTAMP.replace("##VALUE##",t.toString()))}function formatULID(t,r){return""+t.padStart(ULID_TIMESTAMP_LENGTH,"0")+r.padStart(16,"0")}function formatUUID(t,r){t=(""+t.padStart(UUID_TIMESTAMP_LENGTH,"0")+r.padStart(20,"0")).toUpperCase().padStart(32,"0");return`${t.substring(0,8)}-${t.substring(8,12)}-${t.substring(12,16)}-${t.substring(16,20)}-`+t.substring(20)}function ulid(t){return validateTimestamp(t=t??Date.now()),formatULID(encodeTimestamp(t),randomData("ulid"))}ulid.uuid=t=>(validateTimestamp(t=t??Date.now()),formatUUID(encodeTimestamp(t,"uuid"),randomData("uuid"))),ulid.is=t=>isULID(t),ulid.timestamp=t=>{return decodeTimestamp(t,getIdFormat(t))},ulid.data=t=>{return"uuid"===getIdFormat(t)?parseBigInt(cleanUUID(t).substring(UUID_TIMESTAMP_LENGTH).toLowerCase(),16):parseBigInt(crockfordToBase32(t.substring(ULID_TIMESTAMP_LENGTH).toUpperCase()),32)},ulid.toUUID=t=>convertID(t,"uuid"),ulid.fromUUID=t=>convertID(t,"ulid"),ulid.factory=(()=>{let e=Date.now(),n=FACTORY_DATA_MIN;function a(){let t=n.toString(16);return/^[89a-f]$/.test(t.charAt(4))||(n+=BigInt("9223372036854775808"),t=n.toString(16)),t}function i(){n<FACTORY_DATA_MAX?n++:(n=FACTORY_DATA_MIN,validateTimestamp(++e))}return({timestamp:t,data:r}={})=>{if(validateTimestamp(e=t??Date.now()),(n=r??parseBigInt(randomData("uuid"),16))<FACTORY_DATA_MIN||n>FACTORY_DATA_MAX)throw new Error(ERROR_DATA.replace("##VALUE##",n.toString()));return n--,{ulid:()=>{i();var t=a();return formatULID(encodeTimestamp(e,"ulid"),convertData(t,"uuid","ulid"))},uuid:()=>{i();var t=a();return formatUUID(encodeTimestamp(e,"uuid"),convertData(t,"uuid","uuid"))}}}})();export{ULID_CHARS,ULID_TIMESTAMP_LENGTH,UUID_TIMESTAMP_LENGTH,TIMESTAMP_MIN,TIMESTAMP_MAX,FACTORY_DATA_MIN,FACTORY_DATA_MAX,ulid};
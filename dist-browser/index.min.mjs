const ULID_CHARS="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ULID_TIMESTAMP_LENGTH=10,UUID_TIMESTAMP_LENGTH=12,TIMESTAMP_MIN=0,TIMESTAMP_MAX=0xffffffffffff,FACTORY_DATA_MIN=BigInt("302240678275694148452352"),FACTORY_DATA_MAX=BigInt("377789318629571617095679"),regexULID=/^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$/i,regexUUID=/^\{?[0-9A-F]{8}-?[0-9A-F]{4}-?[0-9A-F]{4}-?[0-9A-F]{4}-?[0-9A-F]{12}\}?$/i,ERROR_INVALID="Invalid format",ERROR_TIMESTAMP=`Timestamp (##VALUE##) must be between ${TIMESTAMP_MIN} and `+TIMESTAMP_MAX,ERROR_DATA=`Data value (##VALUE##) must be between ${FACTORY_DATA_MIN} and `+FACTORY_DATA_MAX;function isULID(t){return"string"==typeof t&&regexULID.test(t)}function isUUID(t){return"string"==typeof t&&regexUUID.test(t)}function getIdFormat(t){t=isULID(t)?"ulid":isUUID(t)?"uuid":null;if(null===t)throw new Error(ERROR_INVALID);return t}function parseBigInt(t,r){var e="-"===t.charAt(0),t=t.slice(e?1:0).split("").reduce((t,e)=>t*BigInt(r)+BigInt(parseInt(e,r)),BigInt(0));return e?-t:t}function encode(t){for(var e=[],r=typeof t,n="number"==r?ULID_CHARS.length:BigInt(ULID_CHARS.length);0<t;)e.unshift(ULID_CHARS[t%n]),t="number"==r?Math.floor(t/n):t/n;return e.join("")}function decode(t){var e=t.toUpperCase();let r=BigInt(0);var n=e.length,i=BigInt(ULID_CHARS.length);for(let t=0;t<n;t++)r=r*i+BigInt(ULID_CHARS.indexOf(e[t]));return r}function cleanUUID(t){return t.replace(/[-\{\}]/g,"")}function randomData(t){var e=[...crypto.getRandomValues(new Uint16Array(5))].map((t,e)=>{switch(e){case 0:return Math.floor(t/65535*4096)+16384;case 1:return Math.floor(t/65535*32767)+32768;default:return t}}).map(t=>t.toString(16).padStart(4,"0")).join("");return"uuid"===t?e:convertData(e,"uuid","ulid")}function convertData(t,e,r){return"uuid"===e?(t=(t=cleanUUID(t)).substring(t.length-20).toLowerCase(),"uuid"===r?t:encode(parseBigInt(t,16))):(t=t.substring(t.length-16).toUpperCase(),"ulid"===r?t:decode(t).toString(16))}function encodeTimestamp(t,e="ulid"){return"uuid"===e?t.toString(16).toUpperCase():encode(t)}function decodeTimestamp(t,e="ulid"){return"uuid"===e?parseInt(cleanUUID(t).substring(0,UUID_TIMESTAMP_LENGTH).toLowerCase(),16):Number(decode(t.substring(0,ULID_TIMESTAMP_LENGTH)))}function convertID(t,e){if("string"!=typeof t||"string"!=typeof e)throw new Error(ERROR_INVALID);var r=getIdFormat(t);return r===e?t:("uuid"===e?formatUUID:formatULID)(encodeTimestamp(decodeTimestamp(t,r),e),convertData(t,r,e))}function validateTimestamp(t){if(t<TIMESTAMP_MIN||t>TIMESTAMP_MAX)throw new Error(ERROR_TIMESTAMP.replace("##VALUE##",t.toString()))}function formatULID(t,e){return""+t.padStart(ULID_TIMESTAMP_LENGTH,"0")+e.padStart(16,"0")}function formatUUID(t,e){t=(""+t.padStart(UUID_TIMESTAMP_LENGTH,"0")+e.padStart(20,"0")).toUpperCase().padStart(32,"0");return`${t.substring(0,8)}-${t.substring(8,12)}-${t.substring(12,16)}-${t.substring(16,20)}-`+t.substring(20)}function ulid(t){return validateTimestamp(t=t??Date.now()),formatULID(encodeTimestamp(t),randomData("ulid"))}ulid.uuid=t=>(validateTimestamp(t=t??Date.now()),formatUUID(encodeTimestamp(t,"uuid"),randomData("uuid"))),ulid.is=t=>isULID(t),ulid.timestamp=t=>{return decodeTimestamp(t,getIdFormat(t))},ulid.data=t=>{return"uuid"===getIdFormat(t)?parseBigInt(cleanUUID(t).substring(UUID_TIMESTAMP_LENGTH).toLowerCase(),16):decode(t.substring(ULID_TIMESTAMP_LENGTH).toUpperCase())},ulid.toUUID=t=>convertID(t,"uuid"),ulid.fromUUID=t=>convertID(t,"ulid"),ulid.factory=(()=>{let r=Date.now(),n=FACTORY_DATA_MIN;function i(){let t=n.toString(16);return/^[89a-f]$/.test(t.charAt(4))||(n+=BigInt("9223372036854775808"),t=n.toString(16)),t}function a(){n<FACTORY_DATA_MAX?n++:(n=FACTORY_DATA_MIN,validateTimestamp(++r))}return({timestamp:t,data:e}={})=>{if(validateTimestamp(r=t??Date.now()),(n=e??parseBigInt(randomData("uuid"),16))<FACTORY_DATA_MIN||n>FACTORY_DATA_MAX)throw new Error(ERROR_DATA.replace("##VALUE##",n.toString()));return n--,{ulid:()=>{a();var t=i();return formatULID(encodeTimestamp(r,"ulid"),convertData(t,"uuid","ulid"))},uuid:()=>{a();var t=i();return formatUUID(encodeTimestamp(r,"uuid"),convertData(t,"uuid","uuid"))}}}})();export{ULID_CHARS,ULID_TIMESTAMP_LENGTH,UUID_TIMESTAMP_LENGTH,TIMESTAMP_MIN,TIMESTAMP_MAX,FACTORY_DATA_MIN,FACTORY_DATA_MAX,ulid};